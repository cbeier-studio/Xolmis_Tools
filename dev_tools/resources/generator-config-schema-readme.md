# Mock Data Generator – Global Configuration Specification

This document describes the structure, purpose, and usage of the `generator-config.json` file, which controls the global behavior of the Mock Data Generator. It defines:

- the generation order of tables  
- global execution options  
- table schemas  
- external repositories  
- general metadata  

The goal is to allow users to configure the generator in a clear, predictable, and extensible way.

## 1. Overview

The configuration file follows this general structure:

```json
{
  "version": 1,
  "generationOrder": [...],
  "globalOptions": { ... },
  "schemas": [ ... ],
  "repositories": [ ... ]
}
```

Each section is described in detail below.

## 2. `version`

```json
"version": 1
```

Defines the version of the configuration file format.  
This enables future evolution without breaking compatibility.

- Type: **integer**  
- Required: **yes**

## 3. `generationOrder`

```json
"generationOrder": [
  "gazetteer",
  "projects",
  "expeditions",
  "surveys"
]
```

Defines the order in which tables must be generated.  
This order must respect the dependencies declared in each schema.

- Type: **array of strings**  
- Required: **yes**  
- Each item must match the `name` field of a schema.

### When to use it

- To enforce a fixed generation sequence  
- To avoid cycles or ambiguous ordering  
- To optimize performance (e.g., generate large tables last)

## 4. `globalOptions`

```json
"globalOptions": {
  "temporalCoherence": false,
  "spatialCoherence": false,
  "maxRecordsPerTable": 100000,
  "autoGenerateDependencies": true,
  "forceRegenerateDependencies": false,
  "autoGenerateDescendants": false,
  "outputDir": "./output/"
}
```

Controls the overall behavior of the generator.

### Available fields

| Field | Type | Description |
| --- | --- | --- |
| `temporalCoherence` | boolean | Maintains temporal consistency across tables (related dates). |
| `spatialCoherence` | boolean | Maintains spatial consistency (e.g., coherent coordinates). |
| `maxRecordsPerTable` | integer | Absolute maximum number of records per table. |
| `autoGenerateDependencies` | boolean | Automatically generates dependent tables if needed. |
| `forceRegenerateDependencies` | boolean | Regenerates dependencies even if they already exist. |
| `autoGenerateDescendants` | boolean | Automatically generates descendant tables. |
| `outputDir` | string | Directory where generated files will be saved. |

## 5. `schemas`

The `schemas` section defines all tables that the generator must produce.

Each item represents **a table schema**, containing:

- table name  
- path to the JSON schema file  
- default record count  
- maximum record count  
- dependencies  

### Schema structure

```json
{
  "name": "captures",
  "file": "resources/table-captures.json",
  "defaultCount": 20,
  "maxCount": 100,
  "dependencies": [
    "surveys",
    "people",
    "individuals"
  ],
  "outputFiles": [
    "captures.csv",
    "captures.json"
  ]
}
```

### Available fields

| Field | Type | Required | Description |
| --- | --- | --- | --- |
| `name` | string | yes | Table name (unique identifier). |
| `file` | string | yes | Relative path to the table’s JSON schema. |
| `defaultCount` | integer | yes | Default number of records to generate. |
| `maxCount` | integer | yes | Maximum allowed number of records. |
| `dependencies` | string[] | no | List of tables that must be generated first. |
| `outputFiles` | string[] | yes | List of output file names. |

### How generation works

- The generator uses `generationOrder` to determine the final sequence.  
- `dependencies` is used to validate the order and prevent inconsistencies.
- Use `outputFiles` to generate files in different formats at the same time.
- `defaultCount` may be overridden by runtime parameters.

## 6. `repositories`

Repositories are **external data sources** used by functions, columns, or schemas.

Examples include:

- person names  
- institution names  
- localities  
- taxonomy  
- lists of methods, rubrics, descriptions, etc.

### Repository structure

```json
{
  "name": "person-names",
  "file": "resources/repo-person-names.json",
  "type": "array"
}
```

### Available fields

| Field | Type | Required | Description |
| --- | --- | --- | --- |
| `name` | string | yes | Repository identifier. |
| `file` | string | yes | Relative path to the data file. |
| `type` | string | yes | Structure type: `"array"` or `"objects"`. |
| `fields` | string[] | no | List of relevant fields (for object repositories). |

### Repository types

#### `array`

File contains a simple list:

```json
["A", "B", "C"]
```

#### `objects`

File contains structured objects:

```json
[
  { "countryCode": "BR", "countryName": "Brazil" },
  { "countryCode": "AR", "countryName": "Argentina" }
]
```

## 7. How the generator uses the configuration file

### 1. Loads the configuration file  

Validates it against the JSON Schema.

### 2. Loads all table schemas  

Each table is registered with:

- name  
- file path  
- dependencies  
- record limits  

### 3. Loads all repositories  

Each repository is indexed by name.

### 4. Validates the generation order  

Ensures `generationOrder` respects all dependencies.

### 5. Executes the generation  

For each table:

1. loads the schema  
2. applies functions and rules  
3. uses repositories when needed  
4. generates records  
5. saves output to `outputDir`

## 8. Minimal valid example

```json
{
  "version": 1,
  "generationOrder": ["projects", "expeditions"],
  "globalOptions": {
    "temporalCoherence": false,
    "spatialCoherence": false,
    "maxRecordsPerTable": 10000,
    "autoGenerateDependencies": true,
    "forceRegenerateDependencies": false,
    "autoGenerateDescendants": false,
    "outputDir": "./output/"
  },
  "schemas": [
    {
      "name": "projects",
      "file": "resources/table-projects.json",
      "defaultCount": 10,
      "maxCount": 50
    },
    {
      "name": "expeditions",
      "file": "resources/table-expeditions.json",
      "defaultCount": 20,
      "maxCount": 100,
      "dependencies": ["projects"]
    }
  ],
  "repositories": []
}
```

## 9. Best Practices

- Keep `generationOrder` synchronized with schema dependencies.  
- Use `defaultCount` for testing and `maxCount` as a safety limit.  
- Organize schemas and repositories into separate folders.  
- Use consistent naming across schemas, tables, and dependencies.  
- Avoid circular dependencies.  
- Update `version` whenever the configuration structure changes.
